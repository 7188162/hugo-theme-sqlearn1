{{/*
  å††ã‚°ãƒ©ãƒ•ã«ã‚ˆã‚‹å­¦ç¿’é€²æ—ãƒãƒ£ãƒ¼ãƒˆã‚’è¡¨ç¤ºã™ã‚‹ã‚·ãƒ§ãƒ¼ãƒˆã‚³ãƒ¼ãƒ‰
  ä½¿ã„æ–¹: {{< progress-pie chapter="ç¬¬2ç« " >}}
*/}}

{{- $chapter := .Get "chapter" | default "ã“ã®ç« " -}}

<div class="progress-pie-container" id="progress-pie-{{ .Ordinal }}">
    <h3>ğŸ“Š {{ $chapter }}ã®å­¦ç¿’é€²æ—</h3>
    <p class="chart-description">å­¦ç¿’é …ç›®ã®å®Œäº†çŠ¶æ³ã‚’ã‚ã‹ã‚Šã‚„ã™ãè¡¨ç¤ºã—ã¾ã™</p>
    
    <div class="pie-chart-wrapper">
        <div class="chart-canvas">
            <canvas id="progressPie-{{ .Ordinal }}" width="300" height="300"></canvas>
        </div>
        
        <div class="progress-summary">
            <div class="summary-item">
                <div class="summary-number" id="completed-count-{{ .Ordinal }}">4</div>
                <div class="summary-label">å®Œäº†</div>
            </div>
            <div class="summary-item">
                <div class="summary-number" id="total-count-{{ .Ordinal }}">7</div>
                <div class="summary-label">ç·é …ç›®</div>
            </div>
            <div class="summary-item">
                <div class="summary-number" id="progress-percent-{{ .Ordinal }}">57%</div>
                <div class="summary-label">é€²æ—ç‡</div>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const ctx = document.getElementById('progressPie-{{ .Ordinal }}');
    if (ctx) {
        // ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿
        const completedItems = 4;
        const inProgressItems = 2;
        const notStartedItems = 1;
        const totalItems = completedItems + inProgressItems + notStartedItems;
        
        // é€²æ—ç‡è¨ˆç®—
        const progressPercent = Math.round((completedItems / totalItems) * 100);
        
        // ã‚µãƒãƒªãƒ¼æ›´æ–°
        document.getElementById('completed-count-{{ .Ordinal }}').textContent = completedItems;
        document.getElementById('total-count-{{ .Ordinal }}').textContent = totalItems;
        document.getElementById('progress-percent-{{ .Ordinal }}').textContent = progressPercent + '%';
        
        const pieData = {
            labels: ['å®Œäº†', 'å­¦ç¿’ä¸­', 'æœªé–‹å§‹'],
            datasets: [{
                data: [completedItems, inProgressItems, notStartedItems],
                backgroundColor: [
                    '#10b981', // å®Œäº†ï¼ˆç·‘ï¼‰
                    '#f59e0b', // å­¦ç¿’ä¸­ï¼ˆé»„ï¼‰
                    '#ef4444'  // æœªé–‹å§‹ï¼ˆèµ¤ï¼‰
                ],
                borderColor: [
                    '#059669',
                    '#d97706',
                    '#dc2626'
                ],
                borderWidth: 2,
                hoverOffset: 4
            }]
        };

        new Chart(ctx, {
            type: 'doughnut',
            data: pieData,
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: {
                            padding: 20,
                            usePointStyle: true,
                            font: {
                                size: 14
                            }
                        }
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                const label = context.label || '';
                                const value = context.parsed;
                                const percent = Math.round((value / totalItems) * 100);
                                return label + ': ' + value + 'é …ç›® (' + percent + '%)';
                            }
                        }
                    }
                },
                cutout: '60%',
                elements: {
                    arc: {
                        borderRadius: 4
                    }
                }
            }
        });
    }
});
</script>

<style>
.progress-pie-container {
    background: white;
    border: 1px solid var(--neutral-200);
    border-radius: 16px;
    padding: 2rem;
    margin: 2rem 0;
    box-shadow: var(--shadow-md);
    text-align: center;
}

.progress-pie-container h3 {
    color: var(--primary-blue);
    margin-bottom: 0.5rem;
    font-weight: 600;
}

.chart-description {
    color: var(--neutral-600);
    font-size: 0.9rem;
    margin-bottom: 2rem;
}

.pie-chart-wrapper {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 3rem;
    flex-wrap: wrap;
}

.chart-canvas {
    position: relative;
    width: 300px;
    height: 300px;
}

.progress-summary {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

.summary-item {
    text-align: center;
}

.summary-number {
    font-size: 2rem;
    font-weight: 700;
    color: var(--primary-blue);
    line-height: 1;
    margin-bottom: 0.25rem;
}

.summary-label {
    font-size: 0.9rem;
    color: var(--neutral-600);
    font-weight: 500;
}

@media (max-width: 768px) {
    .pie-chart-wrapper {
        flex-direction: column;
        gap: 2rem;
    }
    
    .chart-canvas {
        width: 250px;
        height: 250px;
    }
    
    .progress-summary {
        flex-direction: row;
        justify-content: space-around;
    }
    
    .summary-number {
        font-size: 1.5rem;
    }
}
</style>